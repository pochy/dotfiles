##### =====================================================
##### åŸºæœ¬è¨­å®š
##### =====================================================

# tmuxèµ·å‹•æ™‚ã®ã‚·ã‚§ãƒ«ã‚’zshã«ã™ã‚‹
set-option -g default-shell /bin/zsh

# 256è‰²ãƒ»TrueColor (RGB) ã‚µãƒãƒ¼ãƒˆ
set -g default-terminal "tmux-256color"
set-option -ga terminal-overrides ",tmux-256color:Tc,xterm-256color:Tc"

# weztermã®hyperlinkæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹
set -as terminal-features 'xterm*:hyperlinks'
set -as terminal-features 'wezterm*:hyperlinks'
set -as terminal-features 'tmux-256color:hyperlinks'

# Neovimã®LSPè¨ºæ–­ãªã©ã§æ³¢ç·šã‚¢ãƒ³ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³(undercurl)ã‚’æœ‰åŠ¹ã«ã™ã‚‹
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d::%p1%{255}%&%dm'

# é€šçŸ¥è¨­å®š
setw -g monitor-activity on
set -g visual-activity on

# ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚¿ã‚¤ãƒ ã®çŸ­ç¸®ï¼ˆVimãªã©ã®æ“ä½œæ€§å‘ä¸Šï¼‰
set -s escape-time 10

# è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# ç•ªå·ã®åŸºæº–å€¤ã‚’1ã‹ã‚‰ã«ã™ã‚‹
set-option -g base-index 1
set-window-option -g pane-base-index 1

# ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ãƒã‚¦ã‚¹è¨­å®š
set -g mouse on
set -g focus-events on

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åã®å¤‰æ›´ã‚’ç„¡åŠ¹åŒ–
set -g allow-rename off
set -g automatic-rename off

# å±¥æ­´ã®ä¿å­˜æœŸé–“ã‚’200000ã«ã™ã‚‹
set -g history-limit 200000

##### =====================================================
##### Catppuccin Frappe Theme
##### =====================================================

# --- ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆå®šç¾© ---
# Base: #303446, Surface0: #414559, Overlay0: #737994, Text: #c6d0f5
# Blue: #8caaee, Mauve: #ca9ee6, Green: #a6d189, Yellow: #e5c890, Red: #e78284

# status bar
set -g status-interval 1
set -g status-justify centre

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼å…¨ä½“
set-option -g status-position top
set-option -g status-style "bg=#303446,fg=#c6d0f5"

# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ©ã‚¤ãƒ³ï¼ˆPrefix + : ã‚’æŠ¼ã—ãŸæ™‚ãªã©ï¼‰
set-option -g message-style "bg=#414559,fg=#ca9ee6,bold"
set -g message-command-style "bg=#414559,fg=#ca9ee6"

# ãƒšã‚¤ãƒ³ã®å¢ƒç•Œç·š
set-option -g pane-border-style "fg=#414559"
set-option -g pane-active-border-style "fg=#8caaee"

# å·¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ã‚»ãƒƒã‚·ãƒ§ãƒ³å
# PrefixãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹æ™‚ã¯èƒŒæ™¯è‰²ãŒ Red (#e78284) ã«å¤‰ã‚ã‚‹
set -g status-left-length 50
set -g status-left "#{?client_prefix,#[bg=#e78284]#[fg=#303446]#[bold] PREFIX #[bg=#414559]#[fg=#c6d0f5] #S ,#[bg=#8caaee]#[fg=#303446] #S }#[default] "

# å³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æ—¥ä»˜ãƒ»æ™‚åˆ» | ãƒ¦ãƒ¼ã‚¶ãƒ¼@ãƒ›ã‚¹ãƒˆ
set-option -g status-right-length 100
set -g status-right "#[fg=#737994,bg=default] %Y-%m-%d %H:%M #[fg=#8caaee,bg=#414559] #(whoami)@#h "
# å³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡ (Macç”¨) ã‚’è¿½åŠ 
set -g status-right-length 150
set -g status-right "#[fg=#737994,bg=default] ğŸ”‹ #(pmset -g batt | grep -Eo '[0-9]+%%') #[fg=#8caaee,bg=#414559] %Y-%m-%d %H:%M #[fg=#303446,bg=#ca9ee6,bold] #(whoami)@#h "

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚¹ãƒˆ
set -g status-justify centre
setw -g window-status-separator ""

# éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
setw -g window-status-style "fg=#c6d0f5,bg=#303446"
setw -g window-status-format " #I:#W "

# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
setw -g window-status-current-style "fg=#303446,bg=#ca9ee6,bold"
# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚¹ãƒˆã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡¨ç¤ºã«æ¡ä»¶åˆ†å²ã‚’è¿½åŠ 
setw -g window-status-current-format "#{?client_prefix,#[fg=#303446]#[bg=#e5c890]#[bold],#[fg=#303446]#[bg=#ca9ee6]#[bold]} #I:#W#F "

# ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¸­ã®é¸æŠç¯„å›²
setw -g mode-style "bg=#626880,fg=#c6d0f5"

# fzf ã®é…è‰²ã‚’ Catppuccin Frappe ã«åˆã‚ã›ã‚‹
set-environment -g FZF_DEFAULT_OPTS ' \
  --color=bg+:#414559,bg:#303446,spinner:#f2d5cf,hl:#e78284 \
  --color=fg:#c6d0f5,header:#e78284,info:#ca9ee6,pointer:#f2d5cf \
  --color=marker:#f2d5cf,fg+:#c6d0f5,prompt:#ca9ee6,hl+:#e78284'

##### =====================================================
##### ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ›¿
##### =====================================================

# Prefix + s ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›–æ˜§æ¤œç´¢ã—ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹
bind s display-popup -E "tmux list-sessions | fzf --reverse --header 'Switch Session' | cut -d: -f1 | xargs tmux switch-client -t"

# [Prefix + f] sesh ã‚’ä½¿ã£ãŸã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€çˆ†é€Ÿåˆ‡ã‚Šæ›¿ãˆ
# display-popup: ç”»é¢ä¸­å¤®ã«æµ®ãä¸ŠãŒã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰ã‚’ä½œæˆ
#   -E: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã§å®Ÿè¡Œã—ãŸã‚³ãƒãƒ³ãƒ‰ãŒçµ‚äº†ã—ãŸã‚‰ã€è‡ªå‹•ã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹
#   -w / -h: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å¹…(width)ã¨é«˜ã•(height)ã‚’ç”»é¢å…¨ä½“ã®ä½•%ã«ã™ã‚‹ã‹æŒ‡å®š
bind "f" display-popup -E -w 80% -h 70% "sesh connect \"$(
  # 1. sesh list ã§å€™è£œã‚’è¡¨ç¤º
  #   -i: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã€‚tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ã ã‘ã§ãªãzoxideã®å±¥æ­´ã‚‚å«ã‚€
  sesh list -i | \
  # 2. fzf ã§çµã‚Šè¾¼ã¿ï¼ˆæ›–æ˜§æ¤œç´¢ï¼‰
  fzf --no-sort --ansi \
    --border-label ' sesh: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ ' \
    --prompt 'âš¡ ' \
    --header ' ^a:å…¨ã¦  ^t:tmux  ^z:zoxide  ^g:è¨­å®š  ^d:å±¥æ­´ ' \
    # 3. fzf å®Ÿè¡Œä¸­ã«ã‚­ãƒ¼ï¼ˆCtrl + æ–‡å­—ï¼‰ã§ãƒªã‚¹ãƒˆã‚’å‹•çš„ã«æ›¸ãæ›ãˆã‚‹ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
    #   change-prompt: å·¦ä¸‹ã®ã‚¢ã‚¤ã‚³ãƒ³(âš¡)ã‚’å¤‰æ›´
    #   reload: sesh ã®ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ãƒªã‚¹ãƒˆã‚’å†å–å¾—
    --bind 'ctrl-a:change-prompt(âš¡ )+reload(sesh list -i)' \
    --bind 'ctrl-t:change-prompt(ğŸªŸ )+reload(sesh list -it)' \
    --bind 'ctrl-z:change-prompt(ğŸ“‚ )+reload(sesh list -iz)' \
    --bind 'ctrl-g:change-prompt(âš™ï¸ )+reload(sesh list -ic)' \
    --bind 'ctrl-d:change-prompt(ğŸ“œ )+reload(sesh list -id)'
)\""

# -----------------------------------------------------------------------------
# Vim ã¨ tmux ã®ãƒšã‚¤ãƒ³ç§»å‹•ã‚’çµ±åˆ (smart-pane-navigation)
# -----------------------------------------------------------------------------
# ç¾åœ¨ã®ãƒšã‚¤ãƒ³ãŒ Vim (n?vim) ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹å¤‰æ•°
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

# Ctrl + hjkl ã§ Vim ã®åˆ†å‰²ã¨ tmux ã®ãƒšã‚¤ãƒ³ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«ç§»å‹•
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# tmux 3.0 ä»¥é™ã®ãŸã‚ã®å¾®èª¿æ•´
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\ '  'select-pane -l'"

# ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¸­ã‚‚ Ctrl + hjkl ã§ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R


##### =====================================================
##### Vimãƒ©ã‚¤ã‚¯æ“ä½œ
##### =====================================================

# ãƒšã‚¤ãƒ³ç§»å‹•
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ãƒšã‚¤ãƒ³ãƒªã‚µã‚¤ã‚º
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5


##### =====================================================
##### Window / Pane æ“ä½œ
##### =====================================================

# æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ»ãƒšã‚¤ãƒ³ã‚’ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§é–‹ã
bind c new-window -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Option(Alt) ã‚­ãƒ¼ã‚’ä½¿ã£ãŸæ“ä½œ
# Option + n/p: æ¬¡ã®/å‰ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ç§»å‹•
bind-key -n M-n next-window
bind-key -n M-p previous-window

# Option(Alt) + hjkl: ãƒšã‚¤ãƒ³é–“ç§»å‹•
bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

# Option(Alt) + æ•°å­—: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ç§»å‹•
bind-key -n M-1 select-window -t :=1
bind-key -n M-2 select-window -t :=2
bind-key -n M-3 select-window -t :=3
bind-key -n M-4 select-window -t :=4
bind-key -n M-5 select-window -t :=5
bind-key -n M-6 select-window -t :=6
bind-key -n M-7 select-window -t :=7
bind-key -n M-8 select-window -t :=8
bind-key -n M-9 select-window -t :=9
bind-key -n M-0 select-window -t :=0


# ==========================================
# ãƒã‚¦ã‚¹
# ==========================================

# ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ“ä½œ
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M


##### =====================================================
##### Copy Mode (vim)
##### =====================================================

# ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§Vimã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰
set -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-selection
bind -T copy-mode-vi Y send -X copy-line

# ãƒšãƒ¼ã‚¹ãƒˆ
bind-key C-S-p paste-buffer


##### =====================================================
##### Clipboard OSåˆ¥ã®ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰é€£æº
##### =====================================================

# Linux
if-shell -b '[ "$(uname)" = "Linux" ]' {
  bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -bi"
  bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xsel -bi"
}

# macOS
if-shell -b '[ "$(uname)" = "Darwin" ]' {
  bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
  bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"
  bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
}

set -g set-clipboard external


##### =====================================================
##### Popup
##### =====================================================

# ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®æ ç·šã®è‰²ã‚’ Frappe ã® Blue ã«è¨­å®š (ãŠå¥½ã¿ã§)
set -g popup-border-style "fg=#8caaee"
# ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¿ã‚¤ãƒˆãƒ«ç·šã®è‰²ã‚’ Frappe ã® Mauve ã«è¨­å®š
set -g popup-border-lines "rounded"

# Option + down ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤º
bind -n M-down popup -xC -yC -w85% -h90% \
  -d '#{pane_current_path}' \
  -E 'tmux a -t flwin || tmux new -s flwin'

# 1. Gitæ“ä½œ (lazygit ã¾ãŸã¯ tig)
# Prefix + g ã§ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¯¾è±¡ã« Git UI ã‚’é–‹ã
# -d '#{pane_current_path}': ç¾åœ¨é–‹ã„ã¦ã„ã‚‹ãƒ‘ãƒãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ„ãƒ¼ãƒ«ã‚’é–‹å§‹ã™ã‚‹
bind g display-popup -E -w 90% -h 90% -d '#{pane_current_path}' "lazygit"

# 2. ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ãƒ‹ã‚¿ãƒ¼ (btop ã¾ãŸã¯ htop)
# Prefix + t ã§ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª
bind t display-popup -E -w 80% -h 80% "btop"

# 3. è¨ˆç®—ç”¨ REPL (Python)
# Prefix + p ã§ã‚µãƒƒã¨è¨ˆç®—ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèªãŒã§ãã‚‹ Python å®Ÿè¡Œç’°å¢ƒã‚’é–‹ã
bind p display-popup -E -w 70% -h 70% "python3"

# (ãŠã¾ã‘) Node.js ãŒãŠå¥½ã¿ã®å ´åˆã¯ã“ã¡ã‚‰
# bind n display-popup -E -w 70% -h 70% "node"



##### =====================================================
##### Catppuccin Frappe Theme (Seamless Edition)
##### =====================================================

# 1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’ä¸‹ã«é…ç½® (Lualineã¨é€£çµã•ã›ã‚‹ãŸã‚)
set-option -g status-position bottom

# 2. èƒŒæ™¯è‰²ã‚’ Lualine ã®ä¸­é–“éƒ¨åˆ†ã®èƒŒæ™¯è‰² (#414559) ã¨ä¸€è‡´ã•ã›ã‚‹
# ã“ã‚Œã«ã‚ˆã‚Šã€å¢ƒç•Œç·šãŒæ¶ˆãˆã¦ä¸€ä½“åŒ–ã—ã¾ã™
set-option -g status-style "bg=#414559,fg=#c6d0f5"

# 3. å·¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (ã‚»ãƒƒã‚·ãƒ§ãƒ³å)
# Lualine ã®å·¦ç«¯ (Mauveè‰²) ã¨ä¼¼ãŸé›°å›²æ°—ã«ã™ã‚‹
set -g status-left-length 50
set -g status-left "#{?client_prefix,#[bg=#e78284]#[fg=#303446]#[bold] PREFIX #[bg=#51576d]#[fg=#c6d0f5] ,#[bg=#ca9ee6]#[fg=#303446]#[bold] ó±—¼ #S }#[default]"

# 4. å³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (æ—¥ä»˜ãƒ»æ™‚åˆ»)
# Lualine ã®å³ç«¯ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã¨çµ±ä¸€
set-option -g status-right-length 100
set -g status-right "#[fg=#737994,bg=#414559] %Y-%m-%d %H:%M #[fg=#303446,bg=#8caaee,bold] #(whoami)@#h "

# 5. ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚¹ãƒˆ (ä¸­å¤®é…ç½®)
set -g status-justify centre
setw -g window-status-separator " â”‚ "

# éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ (èƒŒæ™¯ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã¨åŒåŒ–ã•ã›ã‚‹)
setw -g window-status-style "fg=#c6d0f5,bg=#414559"
setw -g window-status-format "#I:#W"

# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ (å°‘ã—æ˜ã‚‹ã„è‰²ã§æµ®ã‹ã³ä¸ŠãŒã‚‰ã›ã‚‹)
setw -g window-status-current-format "#{?client_prefix,#[fg=#e5c890]#[bg=#414559]#[bold],#[fg=#8caaee]#[bg=#414559]#[bold]} #I:#W#F "